<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>1:1 채팅</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script th:inline="javascript">
        var stompClient = null;
        var roomId = "";

        function connect() {
            roomId = document.getElementById("roomId").value;
            if (!roomId) {
                alert("채팅방 ID를 입력하세요.");
                return;
            }

            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function () {
                stompClient.subscribe('/topic/' + roomId, function (message) {
                    var chat = JSON.parse(message.body);
                    showMessage(chat.sender + ": " + chat.content);
                });
                showMessage("✅ 채팅방 [" + roomId + "] 에 연결됨.");
            });
        }

        function sendMessage() {
            var message = {
                sender: document.getElementById("sender").value,
                content: document.getElementById("message").value
            };

            if (stompClient && roomId) {
                stompClient.send("/app/chat/" + roomId, {}, JSON.stringify(message));
                document.getElementById("message").value = "";
            }
        }

        function showMessage(message) {
            var chatBox = document.getElementById("chatBox");
            var p = document.createElement("p");
            p.textContent = message;
            chatBox.appendChild(p);
        }
    </script>
</head>
<body>
    <h2>1:1 실시간 채팅</h2>
    
    <label>채팅방 ID (user1-user2):</label>
    <input type="text" id="roomId">
    <button onclick="connect()">채팅방 입장</button>

    <br><br>

    <label>보내는 사람:</label>
    <input type="text" id="sender">
    
    <label>메시지:</label>
    <input type="text" id="message">
    <button onclick="sendMessage()">전송</button>

    <h3>채팅 로그:</h3>
    <div id="chatBox" style="border:1px solid black; width:300px; height:200px; overflow:auto;"></div>
</body>
</html>